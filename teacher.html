<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Black Cat Room ‚Äî Teacher PRO</title>

<style>
body{
  margin:0;
  font-family:Arial;
  background:linear-gradient(135deg,#0f0f0f,#141414,#1a1f1c);
  color:#00ff9d;
}

header{
  padding:20px;
  font-size:28px;
  font-weight:bold;
}

.container{
  width:95%;
  margin:auto;
}

input, textarea{
  width:100%;
  padding:10px;
  margin-bottom:10px;
  background:#111;
  color:#00ff9d;
  border:1px solid #00ff9d;
  border-radius:10px;
}

button{
  padding:8px 14px;
  margin:4px 3px;
  background:#00ff9d;
  border:none;
  border-radius:8px;
  cursor:pointer;
  font-weight:bold;
}

button:hover{
  background:#00cc7a;
}

.teacher-layout{
  display:flex;
  gap:30px;
}

.answers-section{
  flex:1;
}

.leaderboard-section{
  width:280px;
  position:sticky;
  top:20px;
  height:fit-content;
  background:#111;
  padding:15px;
  border-radius:15px;
  box-shadow:0 0 15px #00ff9d;
}

.answer-card{
  background:#1a1a1a;
  padding:15px;
  margin-bottom:15px;
  border-left:4px solid #00ff9d;
  border-radius:10px;
}

.answer-text{
  white-space:pre-wrap;
  word-break:break-word;
  background:#111;
  padding:10px;
  border-radius:10px;
  margin:10px 0;
}

.score-buttons button{
  font-size:12px;
}

textarea.comment{
  height:70px;
  resize:vertical;
  margin-top:10px;
}
</style>
</head>

<body>

<header>üêæ Black Cat Room ‚Äî Teacher PRO</header>

<div class="container">

<input id="roomCode" placeholder="Room code...">
<textarea id="taskInput" placeholder="Write task..."></textarea>
<button onclick="sendTask()">Send Task</button>
<button onclick="clearAnswers()">Clear Answers</button>
<button onclick="closeRoom()">Close Room</button>

<div class="teacher-layout">

<div class="answers-section">

<input type="text" id="searchInput" placeholder="üîç Search student...">

<h3>Student Answers</h3>
<div id="answersContainer"></div>

</div>

<div class="leaderboard-section">
<h3>üèÜ Leaderboard</h3>
<div id="leaderboardContainer"></div>
</div>

</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, onValue, set, get, remove } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "YOUR_KEY",
  authDomain: "YOUR_AUTH",
  databaseURL: "YOUR_DB",
  projectId: "YOUR_ID",
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let currentRoom = "";

// SEND TASK
window.sendTask = function(){
  const room = document.getElementById("roomCode").value;
  const task = document.getElementById("taskInput").value;
  if(!room || !task) return alert("Fill fields");

  currentRoom = room;
  set(ref(db,"rooms/"+room+"/task"), task);

  const answersRef = ref(db,"rooms/"+room+"/answers");

  onValue(answersRef,(snapshot)=>{
    const answers = snapshot.val();
    const container = document.getElementById("answersContainer");
    container.innerHTML="";

    if(!answers) return;

    for(let name in answers){

      const div = document.createElement("div");
      div.className="answer-card";
      div.setAttribute("data-name", name.toLowerCase());

      div.innerHTML=`
        <b>${name}</b>
        <div class="answer-text">${answers[name]}</div>

        <textarea class="comment"
        placeholder="Comment..."
        onchange="saveComment('${name}',this.value)">
        </textarea>

        <div class="score-buttons">
          <button onclick="giveScore('${name}',0.5)">+0.5</button>
          <button onclick="giveScore('${name}',1)">+1</button>
          <button onclick="giveScore('${name}',1.5)">+1.5</button>
          <button onclick="giveScore('${name}',2)">+2</button>
          <button onclick="giveScore('${name}',2.5)">+2.5</button>
          <button onclick="giveScore('${name}',3)">+3</button>

          <button onclick="giveScore('${name}',-0.5)">-0.5</button>
          <button onclick="giveScore('${name}',-1)">-1</button>
          <button onclick="giveScore('${name}',-1.5)">-1.5</button>
          <button onclick="giveScore('${name}',-2)">-2</button>
          <button onclick="giveScore('${name}',-2.5)">-2.5</button>
          <button onclick="giveScore('${name}',-3)">-3</button>

          <button onclick="resetScore('${name}')">Reset</button>
        </div>
      `;

      container.appendChild(div);
    }
  });

  // LEADERBOARD
  onValue(ref(db,"rooms/"+room+"/scores"),(snapshot)=>{
    const scores = snapshot.val();
    const board = document.getElementById("leaderboardContainer");
    board.innerHTML="";
    if(!scores) return;

    const sorted = Object.entries(scores)
    .sort((a,b)=>b[1]-a[1]);

    sorted.forEach(([name,pts],i)=>{
      const medal = i==0?"ü•á":i==1?"ü•à":i==2?"ü•â":"üêæ";
      board.innerHTML+=`${medal} ${name} ‚Äî ${pts} pts<br>`;
    });
  });
};

// SCORE
window.giveScore = async function(name,value){
  const room=document.getElementById("roomCode").value;
  const refScore=ref(db,"rooms/"+room+"/scores/"+name);
  const snap=await get(refScore);
  let current=snap.exists()?snap.val():0;
  let newScore=parseFloat(current)+parseFloat(value);
  if(newScore<0) newScore=0;
  await set(refScore,newScore);
};

window.resetScore = function(name){
  const room=document.getElementById("roomCode").value;
  set(ref(db,"rooms/"+room+"/scores/"+name),0);
};

window.saveComment = function(name,text){
  const room=document.getElementById("roomCode").value;
  set(ref(db,"rooms/"+room+"/comments/"+name),text);
};

window.clearAnswers = function(){
  remove(ref(db,"rooms/"+currentRoom+"/answers"));
};

window.closeRoom = function(){
  remove(ref(db,"rooms/"+currentRoom));
};

// SEARCH
document.getElementById("searchInput").addEventListener("input",function(){
  const value=this.value.toLowerCase();
  const cards=document.querySelectorAll(".answer-card");
  cards.forEach(card=>{
    const name=card.getAttribute("data-name");
    card.style.display=name.includes(value)?"block":"none";
  });
});
</script>

</body>
</html>
