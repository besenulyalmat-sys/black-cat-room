<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Black Cat Room ‚Äî Teacher PRO</title>

<style>
body{
  margin:0;
  font-family:Arial;
  background:linear-gradient(135deg,#0f0f0f,#141414,#1a1f1c);
  color:#00ff9d;
}

header{
  padding:20px;
  font-size:28px;
  font-weight:bold;
}

.container{
  width:95%;
  margin:auto;
}

input, textarea{
  width:100%;
  padding:10px;
  margin-bottom:10px;
  background:#111;
  color:#00ff9d;
  border:1px solid #00ff9d;
  border-radius:10px;
}

button{
  padding:8px 14px;
  margin:4px 3px;
  background:#00ff9d;
  border:none;
  border-radius:8px;
  cursor:pointer;
  font-weight:bold;
}

button:hover{
  background:#00cc7a;
}

.teacher-layout{
  display:flex;
  gap:30px;
}

.answers-section{
  flex:1;
}

.leaderboard-section{
  width:280px;
  position:sticky;
  top:20px;
  height:fit-content;
  background:#111;
  padding:15px;
  border-radius:15px;
  box-shadow:0 0 15px #00ff9d;
}

.answer-card{
  background:#1a1a1a;
  padding:15px;
  margin-bottom:15px;
  border-left:4px solid #00ff9d;
  border-radius:10px;
}

.answer-text{
  white-space:pre-wrap;
  word-break:break-word;
  background:#111;
  padding:10px;
  border-radius:10px;
  margin:10px 0;
}

.score-buttons button{
  font-size:12px;
}

textarea.comment{
  height:70px;
  resize:vertical;
  margin-top:10px;
}
<input id="timerInput" placeholder="–í—Ä–µ–º—è (—Å–µ–∫—É–Ω–¥—ã)">
<button onclick="startTimer()">–°—Ç–∞—Ä—Ç —Ç–∞–π–º–µ—Ä–∞</button>

<div id="uncheckedCounter" style="margin:10px 0;"></div>

<button onclick="setFilter('all')">–í—Å–µ</button>
<button onclick="setFilter('unchecked')">–ù–µ–ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ</button>
<button onclick="setFilter('checked')">–ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ</button>
</style>
</head>

<body>

<header>üêæ Black Cat Room ‚Äî Teacher PRO</header>

<div class="container">

<input id="roomCode" placeholder="Room code...">
<textarea id="taskInput" placeholder="Write task..."></textarea>
<button onclick="sendTask()">Send Task</button>
<button onclick="clearAnswers()">Clear Answers</button>
<button onclick="closeRoom()">Close Room</button>

<div class="teacher-layout">

<div class="answers-section">

<input type="text" id="searchInput" placeholder="üîç Search student...">

<h3>Student Answers</h3>
<div id="answersContainer"></div>

</div>

<div class="leaderboard-section">
<h3>üèÜ Leaderboard</h3>
<div id="leaderboardContainer"></div>
</div>

</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, onValue, set, get, remove }
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBsrZ_k2K8u0ybvkEDoEywD_QWzmDTKjyY",
  authDomain: "black-cat-room.firebaseapp.com",
  databaseURL: "https://black-cat-room-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "black-cat-room",
  storageBucket: "black-cat-room.firebasestorage.app",
  messagingSenderId: "80028312826",
  appId: "1:80028312826:web:ee918db88c71a0c1335543",
  measurementId: "G-9W8RSBP8WQ"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let currentFilter="all";

// SEND TASK
window.sendTask = function(){
  const room = document.getElementById("roomCode").value;
  const task = document.getElementById("taskInput").value;
  if(!room || !task) return alert("Fill fields");

  currentRoom = room;
  set(ref(db,"rooms/"+room+"/task"), task);

const answersRef = ref(db,"rooms/"+roomCode+"/answers");

onValue(answersRef,(snapshot)=>{

  const data=snapshot.val();
  const container=document.getElementById("answersContainer");
  container.innerHTML="";

  if(!data) return;

  let unchecked=0;

  for(let student in data){

    const attempts=data[student];
    let index=1;

    for(let id in attempts){

      const attempt=attempts[id];

      if(currentFilter==="checked" && !attempt.checked) continue;
      if(currentFilter==="unchecked" && attempt.checked) continue;

      const div=document.createElement("div");
      div.className="answer-card";

      if(!attempt.checked){
        div.style.borderLeft="4px solid orange";
        unchecked++;
      } else {
        div.style.borderLeft="4px solid lime";
      }

      div.innerHTML=`
        <b>${student}</b> ‚Äî –ü–æ–ø—ã—Ç–∫–∞ ${index}<br>
        <div>${attempt.text}</div>
        <small>${new Date(attempt.time).toLocaleTimeString()}</small><br>
        –°—Ç–∞—Ç—É—Å: ${attempt.checked ? "‚úî –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ" : "‚ùå –ù–µ–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ"}<br>

        <button onclick="grade('${student}','${id}',1)">+1</button>
        <button onclick="grade('${student}','${id}',-1)">-1</button>
        <button onclick="markChecked('${student}','${id}')">
          –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ
        </button>
      `;

      container.appendChild(div);
      index++;
    }
  }

  document.getElementById("uncheckedCounter").innerText=
    "–ù–µ–ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö: "+unchecked;
});
window.grade = async function(student,id,value){

  const room=document.getElementById("roomCode").value;

  const scoreRef=ref(db,"rooms/"+room+"/scores/"+student);
  const snap=await get(scoreRef);

  let current=snap.exists()?snap.val():0;
  await set(scoreRef,current+value);

  await set(
    ref(db,"rooms/"+room+"/answers/"+student+"/"+id+"/scoreGiven"),
    value
  );
};

window.markChecked=function(student,id){

  const room=document.getElementById("roomCode").value;

  set(
    ref(db,"rooms/"+room+"/answers/"+student+"/"+id+"/checked"),
    true
  );
};

window.setFilter=function(type){
  currentFilter=type;
};

window.startTimer=function(){

  const room=document.getElementById("roomCode").value;
  const sec=parseInt(document.getElementById("timerInput").value);

  if(!sec) return;

  const endTime=Date.now()+sec*1000;

  set(ref(db,"rooms/"+room+"/timer/endTime"),endTime);
};
  // LEADERBOARD
  onValue(ref(db,"rooms/"+room+"/scores"),(snapshot)=>{
    const scores = snapshot.val();
    const board = document.getElementById("leaderboardContainer");
    board.innerHTML="";
    if(!scores) return;

    const sorted = Object.entries(scores)
    .sort((a,b)=>b[1]-a[1]);

    sorted.forEach(([name,pts],i)=>{
      const medal = i==0?"ü•á":i==1?"ü•à":i==2?"ü•â":"üêæ";
      board.innerHTML+=`${medal} ${name} ‚Äî ${pts} pts<br>`;
    });
  });
};

// SCORE
window.giveScore = async function(name,value){
  const room=document.getElementById("roomCode").value;
  const refScore=ref(db,"rooms/"+room+"/scores/"+name);
  const snap=await get(refScore);
  let current=snap.exists()?snap.val():0;
  let newScore=parseFloat(current)+parseFloat(value);
  if(newScore<0) newScore=0;
  await set(refScore,newScore);
};

window.resetScore = function(name){
  const room=document.getElementById("roomCode").value;
  set(ref(db,"rooms/"+room+"/scores/"+name),0);
};

window.saveComment = function(name,text){
  const room=document.getElementById("roomCode").value;
  set(ref(db,"rooms/"+room+"/comments/"+name),text);
};

window.clearAnswers = function(){
  remove(ref(db,"rooms/"+currentRoom+"/answers"));
};

window.closeRoom = function(){
  remove(ref(db,"rooms/"+currentRoom));
};

// SEARCH
document.getElementById("searchInput").addEventListener("input",function(){
  const value=this.value.toLowerCase();
  const cards=document.querySelectorAll(".answer-card");
  cards.forEach(card=>{
    const name=card.getAttribute("data-name");
    card.style.display=name.includes(value)?"block":"none";
  });
});
</script>

</body>
</html>
