<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Black Cat Room ‚Äì Student</title>

<style>
body{
    margin:0;
    font-family:Arial;
    background:url("123.png") no-repeat center center fixed;
    background-size:cover;
    color:#00ff9d;
}

/* –∑–∞—Ç–µ–º–Ω–µ–Ω–∏–µ */
body::before{
    content:"";
    position:fixed;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.75);
    z-index:-1;
}

/* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å */
.top-bar{
    display:flex;
    justify-content:space-between;
    align-items:flex-start;
    padding:20px;
}

/* –ë–ª–æ–∫ —Å –∫–æ—Ç–æ–º + –≤—Ö–æ–¥ */
.left-panel{
    display:flex;
    gap:20px;
    align-items:flex-start;
}

/* –§–æ—Ç–æ –∫–æ—Ç–∞ */
#catImage{
    width:180px;
    border-radius:20px;
    transition:0.4s;
}

/* –ê–Ω–∏–º–∞—Ü–∏—è */
.level-up{
    animation:glow 0.6s ease-in-out;
}

@keyframes glow{
    0%{transform:scale(1);}
    50%{transform:scale(1.2);filter:brightness(2);}
    100%{transform:scale(1);}
}

/* –ò–Ω–ø—É—Ç—ã –º–∞–ª–µ–Ω—å–∫–∏–µ */
.login-box input{
    width:160px;
    padding:8px;
    margin-bottom:8px;
    background:#111;
    color:#00ff9d;
    border:1px solid #00ff9d;
    border-radius:8px;
    font-size:14px;
}

.login-box button{
    padding:8px 15px;
    background:#00ff9d;
    border:none;
    border-radius:8px;
    cursor:pointer;
}

/* –†–µ–π—Ç–∏–Ω–≥ —Å–ø—Ä–∞–≤–∞ */
.rank-box{
    text-align:right;
    font-size:16px;
    background:rgba(0,0,0,0.6);
    padding:15px;
    border-radius:15px;
}

/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç */
.main{
    width:90%;
    margin:auto;
    margin-top:20px;
}

textarea{
    width:100%;
    padding:12px;
    background:#111;
    color:#00ff9d;
    border:1px solid #00ff9d;
    border-radius:10px;
}

button.submit{
    margin-top:10px;
    padding:10px 20px;
    background:#00ff9d;
    border:none;
    border-radius:8px;
    cursor:pointer;
}
</style>
</head>

<body>

<div class="top-bar">

    <div class="left-panel">

        <img id="catImage" src="cat-level1.jpg">

        <div class="login-box">
            <input id="roomCode" placeholder="Room">
            <input id="studentName" placeholder="Name">
            <button onclick="joinRoom()">Join</button>
        </div>

    </div>

    <div class="rank-box">
        <div id="rankDisplay">–û—á–∫–∏: 0 / 10<br>–£—Ä–æ–≤–µ–Ω—å: –ù–æ–≤–∏—á–æ–∫</div>
        <h4>üèÜ –¢–æ–ø 5</h4>
        <div id="studentLeaderboard"></div>
    </div>

</div>

<div class="main">

<h2>Current Task:</h2>
<div id="task">Waiting...</div>

<textarea id="answerInput" placeholder="Write answer..."></textarea>
<button class="submit" onclick="submitAnswer()">Submit</button>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBsrZ_k2K8u0ybvkEDoEywD_QWzmDTKjyY",
  authDomain: "black-cat-room.firebaseapp.com",
  databaseURL: "https://black-cat-room-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "black-cat-room",
  storageBucket: "black-cat-room.firebasestorage.app",
  messagingSenderId: "80028312826",
  appId: "1:80028312826:web:ee918db88c71a0c1335543"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let currentRoom="";
let currentLevel=1;

window.joinRoom=function(){

    const room=document.getElementById("roomCode").value;
    const name=document.getElementById("studentName").value;

    if(!room||!name) return alert("Enter room and name");

    currentRoom=room;

    // –∑–∞–¥–∞—á–∞
    onValue(ref(db,"rooms/"+room+"/task"),(snap)=>{
        document.getElementById("task").innerText=snap.val()||"Waiting...";
    });

    // –æ—á–∫–∏
    onValue(ref(db,"rooms/"+room+"/scores/"+name),(snap)=>{

        const points=snap.val()||0;

        let level=1;
        let text="–ù–æ–≤–∏—á–æ–∫";

        if(points>=3){level=2;text="–ö–æ—Ç—ë–Ω–æ–∫";}
        if(points>=6){level=3;text="–û—Ö–æ—Ç–Ω–∏–∫";}
        if(points>=10){level=4;text="–ß—ë—Ä–Ω—ã–π –õ–æ—Ä–¥";}

        document.getElementById("rankDisplay").innerHTML=
            `–û—á–∫–∏: ${points} / 10<br>–£—Ä–æ–≤–µ–Ω—å: ${text}`;

        const img=document.getElementById("catImage");
        img.src="cat-level"+level+".jpg";

        if(level>currentLevel){
            img.classList.add("level-up");
            setTimeout(()=>img.classList.remove("level-up"),600);
        }

        currentLevel=level;
    });

    // –ª–∏–¥–µ—Ä–±–æ—Ä–¥
    onValue(ref(db,"rooms/"+room+"/scores"),(snap)=>{
        const scores=snap.val();
        if(!scores) return;

        const sorted=Object.entries(scores).sort((a,b)=>b[1]-a[1]);
        const board=document.getElementById("studentLeaderboard");
        board.innerHTML="";

        sorted.slice(0,5).forEach(([name,pts],i)=>{
            const medal=i===0?"ü•á":i===1?"ü•à":i===2?"ü•â":"üêæ";
            board.innerHTML+=`${medal} ${name} ‚Äî ${pts}<br>`;
        });
    });
};

window.submitAnswer=function(){
    const name=document.getElementById("studentName").value;
    const answer=document.getElementById("answerInput").value;

    if(!currentRoom||!name||!answer)
        return alert("Fill all fields");

    set(ref(db,"rooms/"+currentRoom+"/answers/"+name),answer);
    alert("Answer sent");
};
</script>

</body>
</html>

