<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Black Cat Room ‚Äì Student PRO</title>

<style>
body{
  margin:0;
  font-family:Arial;
  background:url("cat-bg.jpg") no-repeat center center fixed;
  background-size:cover;
  color:#00ff9d;
}

body::before{
  content:"";
  position:fixed;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.8);
  z-index:-1;
}

.container{
  width:95%;
  margin:auto;
  margin-top:20px;
}

.top-bar{
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.left-top{
  display:flex;
  align-items:center;
  gap:15px;
}

#catImage{
  width:120px;
  border-radius:20px;
  transition:0.5s;
}

textarea{
  width:100%;
  height:300px;
  resize:vertical;
  padding:15px;
  background:#111;
  color:#00ff9d;
  border:1px solid #00ff9d;
  border-radius:15px;
  font-size:16px;
}

button{
  padding:10px 20px;
  background:#00ff9d;
  border:none;
  border-radius:8px;
  cursor:pointer;
}

.rank-box{
  background:#111;
  padding:15px;
  border-radius:15px;
  width:200px;
}

.level-up{
  animation:glow 0.6s;
}

@keyframes glow{
  0%{transform:scale(1);}
  50%{transform:scale(1.2);}
  100%{transform:scale(1);}
}
</style>
</head>

<body>

<div class="container">

<div class="top-bar">

<div class="left-top">
<img id="catImage" src="cat-level1.jpg">
<div>
<input id="roomCode" placeholder="Room">
<input id="studentName" placeholder="Name">
<button onclick="joinRoom()">Join</button>
</div>
</div>
<div id="teacherCommentBox" style="
  margin-top:15px;
  padding:15px;
  background:#111;
  border:1px solid #00ff9d;
  border-radius:15px;
  min-height:60px;
">
  <b>üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —É—á–∏—Ç–µ–ª—è:</b>
  <div id="teacherCommentText">–ù–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤</div>
</div>
<div id="rankDisplay"></div>
<div class="rank-box">
<div id="rankDisplay">–û—á–∫–∏: 0</div>
<h4>üèÜ Top 5</h4>
<div id="studentLeaderboard"></div>
</div>

</div>

<h2>Current Task:</h2>
<div id="task">Waiting...</div>

<textarea id="answerInput" placeholder="Write answer..."></textarea>
<button onclick="submitAnswer()">Submit</button>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, onValue, set } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBsrZ_k2K8u0ybvkEDoEywD_QWzmDTKjyY",
  authDomain: "black-cat-room.firebaseapp.com",
  databaseURL: "https://black-cat-room-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "black-cat-room",
  storageBucket: "black-cat-room.firebasestorage.app",
  messagingSenderId: "80028312826",
  appId: "1:80028312826:web:ee918db88c71a0c1335543",
  measurementId: "G-9W8RSBP8WQ"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let currentRoom="";
let currentLevel=1;

window.joinRoom=function(){

  const room=document.getElementById("roomCode").value;
  const name=document.getElementById("studentName").value;
  if(!room||!name) return alert("Fill fields");

  currentRoom=room;

 // üí¨ –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —É—á–∏—Ç–µ–ª—è
onValue(ref(db, "rooms/"+room+"/comments/"+name),(snap)=>{
  const text = snap.val();
  document.getElementById("teacherCommentText").innerText =
    text ? text : "–ù–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤";
});

  onValue(ref(db,"rooms/"+room+"/scores/"+name),snap=>{
    const points=snap.val()||0;

    let level=1;
    let levelText="–ù–æ–≤–∏—á–æ–∫";

    if(points>=3){level=2;levelText="–ö–æ—Ç—ë–Ω–æ–∫";}
    if(points>=6){level=3;levelText="–û—Ö–æ—Ç–Ω–∏–∫";}
    if(points>=10){level=4;levelText="–ß—ë—Ä–Ω—ã–π –õ–æ—Ä–¥";}

    document.getElementById("rankDisplay").innerHTML=
    `–û—á–∫–∏: ${points}/10<br>–£—Ä–æ–≤–µ–Ω—å: ${levelText}`;

    const img=document.getElementById("catImage");
    img.src="cat-level"+level+".jpg";

    if(level>currentLevel){
      img.classList.add("level-up");
      setTimeout(()=>img.classList.remove("level-up"),600);
    }

    currentLevel=level;
  });

  onValue(ref(db,"rooms/"+room+"/scores"),snap=>{
    const scores=snap.val();
    const board=document.getElementById("studentLeaderboard");
    board.innerHTML="";
    if(!scores) return;

    const sorted=Object.entries(scores)
    .sort((a,b)=>b[1]-a[1]);

    sorted.slice(0,5).forEach(([name,pts],i)=>{
      const medal=i==0?"ü•á":i==1?"ü•à":i==2?"ü•â":"üêæ";
      board.innerHTML+=`${medal} ${name} ‚Äî ${pts}<br>`;
    });
  });
};

window.submitAnswer=function(){
  const name=document.getElementById("studentName").value;
  const answer=document.getElementById("answerInput").value;
  if(!currentRoom||!name||!answer) return alert("Fill all");
  set(ref(db,"rooms/"+currentRoom+"/answers/"+name),answer);
};
</script>

</body>
</html>
