<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Black Cat Room ‚Äì Student PRO 3.0</title>

<style>
body{
  margin:0;
  font-family:Arial;
  background:url("cat-bg.jpg") no-repeat center center fixed;
  background-size:cover;
  color:#00ff9d;
}

body::before{
  content:"";
  position:fixed;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.8);
  z-index:-1;
}

.container{
  width:95%;
  margin:auto;
  margin-top:20px;
}

.top-bar{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap:20px;
}

.left-top{
  display:flex;
  align-items:center;
  gap:15px;
}

#catImage{
  width:120px;
  border-radius:20px;
  transition:0.5s;
}

textarea{
  width:100%;
  height:300px;
  resize:vertical;
  padding:15px;
  background:#111;
  color:#00ff9d;
  border:1px solid #00ff9d;
  border-radius:15px;
  font-size:16px;
}

button{
  padding:10px 20px;
  background:#00ff9d;
  border:none;
  border-radius:8px;
  cursor:pointer;
}

.rank-box{
  background:#111;
  padding:15px;
  border-radius:15px;
  width:220px;
}

.level-up{
  animation:glow 0.6s;
}

@keyframes glow{
  0%{transform:scale(1);}
  50%{transform:scale(1.2);}
  100%{transform:scale(1);}
}
</style>
</head>

<body>

<div class="container">

<div class="top-bar">

<div class="left-top">
<img id="catImage" src="cat-level1.jpg">
<div>
<input id="roomCode" placeholder="Room">
<input id="studentName" placeholder="Name">
<button onclick="joinRoom()">Join</button>
</div>
</div>

<div>
<div id="timerBox" style="font-size:18px;margin-bottom:10px;"></div>

<div id="teacherCommentBox" style="
  padding:10px;
  background:#111;
  border:1px solid #00ff9d;
  border-radius:10px;
  margin-bottom:10px;
">
<b>üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —É—á–∏—Ç–µ–ª—è:</b>
<div id="teacherCommentText">–ù–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤</div>
</div>

<div class="rank-box">
<div id="rankDisplay">–û—á–∫–∏: 0</div>
<h4>üèÜ Top 5</h4>
<div id="studentLeaderboard"></div>
</div>

</div>
</div>

<h2>Current Task:</h2>
<div id="task">Waiting...</div>

<textarea id="answerInput" placeholder="Write answer..."></textarea>
<button onclick="submitAnswer()">Submit</button>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, onValue, push }
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyBsrZ_k2K8u0ybvkEDoEywD_QWzmDTKjyY",
  authDomain: "black-cat-room.firebaseapp.com",
  databaseURL: "https://black-cat-room-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "black-cat-room",
  storageBucket: "black-cat-room.firebasestorage.app",
  messagingSenderId: "80028312826",
  appId: "1:80028312826:web:ee918db88c71a0c1335543",
  measurementId: "G-9W8RSBP8WQ"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let currentRoom="";
let currentName="";
let currentLevel=1;

// JOIN ROOM
window.joinRoom=function(){

  const room=document.getElementById("roomCode").value;
  const name=document.getElementById("studentName").value;

  if(!room||!name) return alert("Fill fields");

  currentRoom=room;
  currentName=name;

  // TASK
  onValue(ref(db,"rooms/"+room+"/task"),snap=>{
    document.getElementById("task").innerText =
      snap.val() || "Waiting...";
  });

  // COMMENTS
  onValue(ref(db,"rooms/"+room+"/comments/"+name),snap=>{
    document.getElementById("teacherCommentText").innerText =
      snap.val() || "–ù–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤";
  });

  // TIMER
  onValue(ref(db,"rooms/"+room+"/timer/endTime"),snap=>{
    const endTime=snap.val();
    if(!endTime) return;

    const interval=setInterval(()=>{
      const diff=endTime-Date.now();

      if(diff<=0){
        clearInterval(interval);
        document.getElementById("answerInput").disabled=true;
        document.getElementById("timerBox").innerText="‚õî –í—Ä–µ–º—è –≤—ã—à–ª–æ";
      }else{
        document.getElementById("timerBox").innerText=
          "‚è≥ –û—Å—Ç–∞–ª–æ—Å—å: "+Math.floor(diff/1000)+" —Å–µ–∫";
      }
    },1000);
  });

  // SCORE & LEVEL
  onValue(ref(db,"rooms/"+room+"/scores/"+name),snap=>{

    const points=snap.val()||0;

    let level=1;
    let levelText="–ù–æ–≤–∏—á–æ–∫";

    if(points>=3){level=2;levelText="–ö–æ—Ç—ë–Ω–æ–∫";}
    if(points>=6){level=3;levelText="–û—Ö–æ—Ç–Ω–∏–∫";}
    if(points>=10){level=4;levelText="–ß—ë—Ä–Ω—ã–π –õ–æ—Ä–¥";}

    document.getElementById("rankDisplay").innerHTML=
      `–û—á–∫–∏: ${points}/10<br>–£—Ä–æ–≤–µ–Ω—å: ${levelText}`;

    const img=document.getElementById("catImage");
    img.src="cat-level"+level+".jpg";

    if(level>currentLevel){
      img.classList.add("level-up");
      setTimeout(()=>img.classList.remove("level-up"),600);
    }

    currentLevel=level;
  });

  // LEADERBOARD
  onValue(ref(db,"rooms/"+room+"/scores"),snap=>{
    const scores=snap.val();
    const board=document.getElementById("studentLeaderboard");
    board.innerHTML="";
    if(!scores) return;

    const sorted=Object.entries(scores)
      .sort((a,b)=>b[1]-a[1]);

    sorted.slice(0,5).forEach(([name,pts],i)=>{
      const medal=i==0?"ü•á":i==1?"ü•à":i==2?"ü•â":"üêæ";
      board.innerHTML+=`${medal} ${name} ‚Äî ${pts}<br>`;
    });
  });
};

// SUBMIT ANSWER (–∫–∞–∂–¥–∞—è –ø–æ–ø—ã—Ç–∫–∞ –æ—Ç–¥–µ–ª—å–Ω–æ)
window.submitAnswer=function(){

  const text=document.getElementById("answerInput").value;
  if(!text) return;

  push(ref(db,"rooms/"+currentRoom+"/answers/"+currentName),{
    text:text,
    time:Date.now(),
    checked:false,
    scoreGiven:0
  });

  document.getElementById("answerInput").value="";
};
</script>

</body>
</html>
