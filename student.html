<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Black Cat Room ‚Äì Student</title>

<style>
body {
    margin:0;
    font-family:Arial;
    background: url("123.png") no-repeat center center fixed;
    background-size: cover;
    color:#00ff9d;
    position: relative;
}

/* –∑–∞—Ç–µ–º–Ω–µ–Ω–∏–µ –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ */
body::before {
    content:"";
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background: rgba(0,0,0,0.75);
    z-index:-1;
}

.container {
    width:90%;
    margin:auto;
    margin-top:30px;
}

input, textarea {
    width:100%;
    padding:10px;
    margin-bottom:10px;
    background:#111;
    color:#00ff9d;
    border:1px solid #00ff9d;
    border-radius:8px;
}

button {
    padding:10px 20px;
    background:#00ff9d;
    border:none;
    border-radius:8px;
    cursor:pointer;
    font-weight:bold;
    transition:0.3s;
}

button:hover {
    background:#00cc7a;
}

#catImage {
    width:200px;
    border-radius:20px;
    margin:20px 0;
    transition:0.5s;
}

.level-up {
    animation: glow 0.6s ease-in-out;
}

@keyframes glow {
    0% { transform:scale(1); filter:brightness(1); }
    50% { transform:scale(1.1); filter:brightness(1.8); }
    100% { transform:scale(1); filter:brightness(1); }
}
</style>
</head>

<body>

<div class="container">

<h1>üêæ Black Cat Room ‚Äì Student</h1>

<!-- üê± –ê–í–ê–¢–ê–† –ö–û–¢–ê -->
<img id="catImage" src="cat-level1.jpg.jpg">

<input id="roomCode" placeholder="Room code...">
<input id="studentName" placeholder="Your name...">
<button onclick="joinRoom()">Join</button>

<h2>Current Task:</h2>
<div id="task">Waiting...</div>

<textarea id="answerInput" placeholder="Write answer..."></textarea>
<button onclick="submitAnswer()">Submit</button>

<div id="rankDisplay" style="margin-top:20px; font-size:20px;"></div>
<h3>üèÜ –û–±—â–∏–π —Ä–µ–π—Ç–∏–Ω–≥:</h3>
<div id="studentLeaderboard"></div>
<div id="backgroundLeaderboard" 
     style="margin-top:20px; opacity:0.8;"></div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBsrZ_k2K8u0ybvkEDoEywD_QWzmDTKjyY",
  authDomain: "black-cat-room.firebaseapp.com",
  databaseURL: "https://black-cat-room-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "black-cat-room",
  storageBucket: "black-cat-room.firebasestorage.app",
  messagingSenderId: "80028312826",
  appId: "1:80028312826:web:ee918db88c71a0c1335543"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let currentRoom = "";
let currentLevel = 1;

// ===== JOIN ROOM =====
// ===== JOIN ROOM =====
window.joinRoom = function() {

  const room = document.getElementById("roomCode").value;
  const name = document.getElementById("studentName").value;

  if (!room || !name) 
    return alert("Enter room and name");

  currentRoom = room;

  // ===== –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∑–∞–¥–∞–Ω–∏–µ =====
  const taskRef = ref(db, "rooms/" + room + "/task");

  onValue(taskRef, (snapshot) => {
    document.getElementById("task").innerText =
      snapshot.val() || "Waiting...";
  });

  // ===== –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –æ—á–∫–∏ =====
  const scoreRef = ref(db, "rooms/" + room + "/scores/" + name);

  onValue(scoreRef, (snapshot) => {

    const points = snapshot.val() || 0;

    // –ø—Ä–æ–≥—Ä–µ—Å—Å –¥–æ 10
    let progress = Math.min(points, 10);

    // —É—Ä–æ–≤–µ–Ω—å
    let level = "–ù–æ–≤–∏—á–æ–∫";
    if (points >= 3) level = "–ö–æ—Ç—ë–Ω–æ–∫";
    if (points >= 6) level = "–û—Ö–æ—Ç–Ω–∏–∫";
    if (points >= 10) level = "–ß—ë—Ä–Ω—ã–π –õ–æ—Ä–¥";

    document.getElementById("rankDisplay").innerHTML = `
      üê± –û—á–∫–∏: ${points} / 10<br>
      üéñ –£—Ä–æ–≤–µ–Ω—å: ${level}
    `;
  });

  // ===== –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ leaderboard (—Ñ–æ–Ω-—Ç–∞–±–ª–∏—Ü–∞) =====
  const scoresRef = ref(db, "rooms/" + room + "/scores");

  onValue(scoresRef, (snapshot) => {
    const scores = snapshot.val();
    const board = document.getElementById("backgroundLeaderboard");

    if (!scores) return;

    const sorted = Object.entries(scores)
      .sort((a,b) => b[1] - a[1]);

    board.innerHTML = "<h3>üèÜ –õ–∏–¥–µ—Ä—ã</h3>";

    sorted.slice(0,5).forEach(([name, pts]) => {
      board.innerHTML += `${name} ‚Äî ${pts} pts<br>`;
    });
  });

};


  // ‚ú® –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏ –ø–æ–≤—ã—à–µ–Ω–∏–∏
  if(newLevel > currentLevel) {
    const img = document.getElementById("catImage");
    img.classList.add("level-up");
    setTimeout(() => {
      img.classList.remove("level-up");
    }, 600);
  }

  currentLevel = newLevel;
  document.getElementById("catImage").src = catImg;
}

// ===== –û–¢–ü–†–ê–í–ö–ê –û–¢–í–ï–¢–ê =====
window.submitAnswer = function() {
  const name = document.getElementById("studentName").value;
  const answer = document.getElementById("answerInput").value;

  if(!currentRoom || !name || !answer)
    return alert("Join room and fill all fields");

  set(ref(db, "rooms/" + currentRoom + "/answers/" + name), answer);

  alert("Answer sent");
};
</script>

</body>
</html>
